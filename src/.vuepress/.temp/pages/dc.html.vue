<template><div><p>DC：Data Centers（数据中心），Telegram在世界各地部署有5个数据中心：</p>
<ul>
<li>DC1：美国迈阿密（Miami, USA）</li>
<li>DC2：荷兰阿姆斯特丹（Amsterdam, NL）</li>
<li>DC3：美国迈阿密（Miami, USA）</li>
<li>DC4：荷兰阿姆斯特丹（Amsterdam, NL）</li>
<li>DC5：新加坡</li>
</ul>
<h2 id="dc的分配规则" tabindex="-1"><a class="header-anchor" href="#dc的分配规则"><span>DC的分配规则</span></a></h2>
<ol>
<li>根据 <a href="https://core.telegram.org/api/datacenter" target="_blank" rel="noopener noreferrer">Telegram 官方文档说明</a> ，账号属于哪个DC是由注册时的IP决定的。</li>
<li>但实际上并非如此，账号属于哪个DC实际上是由注册账号时选择的国家/地区决定的，比如<code v-pre>+86</code>的号码大都是在DC5，<code v-pre>+1</code>的号码大都是在DC1。</li>
<li>DC是注册时候就决定了，<strong>无法更换</strong>，更换手机号也不能更换DC，如果想要更换DC，只有注销重新注册新账号。</li>
</ol>
<h2 id="如何知道自己账号属于哪个dc" tabindex="-1"><a class="header-anchor" href="#如何知道自己账号属于哪个dc"><span>如何知道自己账号属于哪个DC</span></a></h2>
<p>可以用机器人快速查询自己账号属于哪个DC： <a href="https://t.me/nmnmfunBot" target="_blank" rel="noopener noreferrer">@nmnmfunBot</a> <a href="https://t.me/KinhRoBot" target="_blank" rel="noopener noreferrer">@KinhRoBot</a> <a href="https://t.me/Sean_Bot" target="_blank" rel="noopener noreferrer">@Sean_Bot</a> <a href="https://t.me/WooMaiBot" target="_blank" rel="noopener noreferrer">@WooMaiBot</a></p>
<p>下面提供几个进阶方法。</p>
<h3 id="方法一-登录法" tabindex="-1"><a class="header-anchor" href="#方法一-登录法"><span>方法一：登录法</span></a></h3>
<p>当客户端登录账号时，需要连接到正确的DC上获取用户数据。如果连接到了错误的DC，便无法登录。根据以上特性，我们可以通过MTProto协议（官方客户端使用的协议）连接到不同DC来确定自己账号所在的DC。</p>
<div class="hint-container note">
<p class="hint-container-title">例如</p>
<p>我们使用会被分配到DC2的手机号连接DC1，调用<code v-pre>auth.sendCode</code>接口，尝试发送验证码，注册一个账号。此时服务端会返回<code v-pre>PHONE_MIGRATE_2</code>错误，提示客户端应当要连接DC2（如果连接DC2后进行同样操作，便会直接发送验证码）。这样，我们就知道这个帐号是一个 DC2 的帐号。</p>
</div>
<div class="hint-container tip">
<p class="hint-container-title">提示</p>
<p>这种方法对于已注册的帐号同样有效，但是这种方法需要知道用户的手机号，难以用来查询群友所在的DC。</p>
</div>
<h3 id="方法二-头像-文件法" tabindex="-1"><a class="header-anchor" href="#方法二-头像-文件法"><span>方法二：头像/文件法</span></a></h3>
<p>客户端在下载用户头像时，可以通过MTProto协议<code v-pre>userProfilePhoto</code>结构体中的<code v-pre>dc_id</code> 字段，来获知用户所在的DC。这种方法是通过用户上传的文件所在的DC，来判断用户所在的DC。大多数支持查看DC的第三方客户端用的就是这个方法。</p>
<h3 id="方法三-web-cdn法" tabindex="-1"><a class="header-anchor" href="#方法三-web-cdn法"><span>方法三：Web CDN法</span></a></h3>
<p>通过<code v-pre>https://t.me/username</code>链接显示的头像的CDN链接判断所在DC。例如，控制台中的CDN域名是<code v-pre>cdn1.telegram-cdn.org</code>，则用户在DC1。</p>
<p>需要注意的是，由于DC2与DC3会“借用”同地点的DC4与DC1域名来提供Web CDN服务，这种方法获取到的DC可能并不准确。</p>
<details class="hint-container details"><summary>附：注册手机号区号对应的Telegram DC</summary>
<figure><img src="https://s2.loli.net/2023/07/28/RtW7l4m8fIbehSM.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
</details>
<h2 id="代理单独为-telegram-设置策略组有用吗" tabindex="-1"><a class="header-anchor" href="#代理单独为-telegram-设置策略组有用吗"><span>代理单独为 Telegram 设置策略组有用吗?</span></a></h2>
<ol>
<li>你的账号属于哪个DC，你的数据（消息、图片、文件等）也就存放在哪个DC，你给别人私聊和群里发送媒体，则别人是从你的账号所在的DC下载在客户端上才能看到的。</li>
<li>假如你的账号在DC5，不管别人的账号在DC几，查看你发送的媒体都是从DC5上下载。你去查看别人发的文件也是如此的，别人的账号在DC1，你的账号在DC5，那你查看他发送的媒体也是从DC1下载的。</li>
<li>理解了以上两点，你就会发现单独为Telegram设置策略组是没有意义的，因为群里的人，有的在DC1，有的在DC5，你把Telegram策略设为SG，那查看DC1发送的媒体也就要从SG绕一下，不过感知差别不明显。</li>
</ol>
<h2 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h2>
<h3 id="经常宕机的dc5" tabindex="-1"><a class="header-anchor" href="#经常宕机的dc5"><span>经常宕机的DC5</span></a></h3>
<p>在5个DC中，DC5在Telegram中文圈格外知名——并不是因为它默默无闻服务了大量的中文用户，而是因为它经常宕机。</p>
<p>当DC5宕机时，身处DC5的用户无法使用Telegram，此时的Telegram圈内的话题往往会变成「DC5 怎么又挂啦」。DC5 用户只能等待自己不断“重连中”的客户端恢复后，再与其他DC的群友们一起批判DC5。</p>
<h3 id="dc3的消失" tabindex="-1"><a class="header-anchor" href="#dc3的消失"><span>DC3的消失</span></a></h3>
<p>细心的用户会发现，上面的图片中DC3没有用户。Telegram在2020年已将DC3用户全部迁移至DC1，同时DC3也不再接受任何新用户。有说法认为，DC3仅作为Telegram故障转移使用。</p>
</div></template>


